#!/bin/sh

#This is Aubit 4gl compiler warper script

AUBITDIR=`aubit-config AUBITDIR`

if [ "$AUBITDIR" = "" ]; then
    echo "ERROR: AUBITDIR is empty. Stop."
	aubit-config AUBITDIR
    exit 3
fi

#echo "hello from aubit"

#Strip drive letter, because it will contain ":"
TMPAUBITDIR=`echo $AUBITDIR | sed -e 's/C://'g`
TMPAUBITDIR=`echo $TMPAUBITDIR | sed -e 's/D://'g`

#Strip Cygwin path, because PATH set here will be used by bash to find executables in AUBITDIR
TMPAUBITDIR=`echo $TMPAUBITDIR | sed -e 's/\/cygwin//'g`

PATH=$TMPAUBITDIR/bin:$PATH

#Used to find libaubit4gl _only_ and _only_ on UNIX
LD_LIBRARY_PATH=$AUBITDIR/lib:$LD_LIBRARY_PATH

if [ "$COMSPEC" != "" ]; then
	#dll files are searched for by Windows loader only in PATH
	PATH=$AUBITDIR/lib:$PATH
fi
export AUBITDIR PATH LD_LIBRARY_PATH


if [ $# -lt 1 -o "$1" = "--help" ]
then
    echo
	echo Aubit 4gl compiler warper script: $0
    echo
    echo Usage:
    echo '  aubit [--verbose] <command> <command parameters...>'
	echo
    echo ' For details, try: '
    echo '    aubit <command> --help'
    echo '    where <command> is one of the following:'
	echo ' 4glpc - main compiler script (scheduled to be obsoleted)'
    echo ' 4glc - 4gl to [C|Perl|EC|...]-code compiler'
	echo ' fcompile - form file (.per) compiler'
    echo ' mcompile - menu file (.menu) compiler'
    echo ' amkmessage - help file (.hlp) compiler'
    echo
    echo ' Use "aubit-config" to inspect Aubit compiler configuration '
    echo
	exit 1
fi

COMMAND=$1

#FIXME: on CygWin, we must add "bash" in front of "4glpc" otherwise standard "sh" will be
#used and give us bunch of errors in 4glpc. We need to recognize and fix this here

   ################
   case $COMMAND in
   ################

   *verbose)
        echo "AUBITDIR=$AUBITDIR"
        echo "PATH=$PATH"
        $2 $3 $4 $5 $6 $7 $8 $9
   ;;

   *)
        $@

   ;;

  ####
  esac
  ####


#----------------------------- EOF --------------------------

