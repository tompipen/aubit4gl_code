; +----------------------------------------------------------------------+
; | Aubit 4gl Language Compiler Version $.0                              |
; +----------------------------------------------------------------------+
; | Copyright (c) 2000-1 Aubit Development Team (See Credits file)       |
; +----------------------------------------------------------------------+
; | This program is free software; you can redistribute it and/or modify |
; | it under the terms of one of the following licenses:                 |
; |                                                                      |
; |  A) the GNU General Public License as published by the Free Software |
; |     Foundation; either version 2 of the License, or (at your option) |
; |     any later version.                                               |
; |                                                                      |
; |  B) the Aubit License as published by the Aubit Development Team and |
; |     included in the distribution in the file: LICENSE                |
; |                                                                      |
; | This program is distributed in the hope that it will be useful,      |
; | but WITHOUT ANY WARRANTY; without even the implied warranty of       |
; | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        |
; | GNU General Public License for more details.                         |
; |                                                                      |
; | You should have received a copy of both licenses referred to here.   |
; | If you did not, or have any questions about Aubit licensing, please  |
; | contact afalout@ihug.co.nz                                           |
; +----------------------------------------------------------------------+
;
; $Id: aubit-InnoSetup.iss.in,v 1.1 2002-10-30 01:46:44 afalout Exp $
;


;/**
; * @file
; *
; Script for creating "Inno Setup" Windows Wizzard install program for Aubit 4gl.
; To compile it, you will need "My Inno Setup Extensions" with support for Pascal scripting.
; See http://www.wintax.nl/isx/ and http://www.jrsoftware.org/isinfo.php
; *
; * @todo Adapt for Windows 9x: add path to autoexec.bat, ask to reboot
; * @todo Get version number and source directories via AutoConf
; * @todo Check if PATH already contain needed paths, before adding them
; * @todo Try installing to "Program Files"
; * @todo Resolve environmetn update on W2K
; * @todo migrate 4glpc shell script to 4glc.exe
; * @todo Verify if user has admin privilege before writing to HKLM
; * @todo Add GWD files
; * @todo Add Manual
; * @todo TUI support
; * @todo Verify that MinGW is already installed
; * @todo Add GTK+ themes files
; * @todo Verify that there is no non-MinGW gcc in path before MinGW one, hiding it.
; */

[Setup]
AppName=@FULLNAME@
AppVerName=@FULLNAME@ @AUBIT_VERSION@.@AUBIT_BUILD@
AppPublisher=@AUBIT_PUBLISHER@
AppPublisherURL=http://@AUBIT_WEBSITE@
AppSupportURL=http://@AUBIT_WEBSITE@
AppUpdatesURL=http://@AUBIT_WEBSITE@
DefaultDirName={sd}\@SHORTNAME@
DefaultGroupName=@FULLNAME@
AllowNoIcons=true
;Aubit license:
;LicenseFile=@IS_SOURCE@\docs\LICENSE
;GPL:
LicenseFile=@IS_SOURCE@\docs\COPYING
InfoBeforeFile=@IS_SOURCE@\docs\README-Windows.txt
;InfoAfterFile=@IS_SOURCE@\docs\changelog.txt
;OutputBaseFilename=@FULLNAME@ @AUBIT_VERSION@.@AUBIT_BUILD@
;where to put resulting setup exe:
;OutputDir=c:\tmp
;WizardImageFile=myimage.bmp

[Components]
Name: runtime; Description: Aubit 4GL runtime libraries; Types: full standard compact custom runtime; Flags: fixed
Name: compiler; Description: Aubit 4GL compiler; Types: full standard compact custom
Name: help; Description: Help and Manual Files; Types: full standard
Name: 4GLexamples; Description: 4GL source code example Files; Types: full standard
Name: Shell; Description: Shell scripts Files; Types: full
Name: Make; Description: Make Files; Types: full
Name: GTK; Description: GTK+ GUI libraries; Types: full standard runtime
Name: util; Description: "Utilities "; Types: full standard runtime
Name: GWD; Description: GWD editor and IDE Files; Types: full

[Types]
Name: standard; Description: Standard installation
Name: runtime; Description: Run-time libraries
Name: full; Description: Full installation
Name: compact; Description: Compact installation
Name: custom; Description: Custom installation; Flags: iscustom

[Files]
;=========================
; Compiler files
Source: @IS_SOURCE@\bin\4glc.exe; DestDir: {app}\bin; CopyMode: alwaysoverwrite; Components: compiler
Source: @IS_SOURCE@\bin\aubit-config.exe; DestDir: {app}\bin; Components: compiler
Source: @IS_SOURCE@\bin\fcompile.exe; DestDir: {app}\bin; Components: compiler
Source: @IS_SOURCE@\bin\fdecompile.exe; DestDir: {app}\bin; Components: compiler
Source: @IS_SOURCE@\bin\mcompile.exe; DestDir: {app}\bin; Components: compiler
Source: @IS_SOURCE@\bin\mkmess.exe; DestDir: {app}\bin; Components: compiler
Source: @IS_SOURCE@\incl\a4gl_incl_4gldef.h; DestDir: {app}\incl; Components: compiler
Source: @IS_SOURCE@\incl\a4gl_incl_4glhdr.h; DestDir: {app}\incl; Components: compiler
Source: @IS_SOURCE@\lib\libLEX_C.dll; DestDir: {app}\lib; Components: compiler
Source: @IS_SOURCE@\lib\libLEX_PERL.dll; DestDir: {app}\lib; Components: compiler
Source: @IS_SOURCE@\lib\lib4glc.dll; DestDir: {app}\bin; Components: compiler

;=========================
; Run-time files
Source: @IS_SOURCE@\bin\mdecompile.exe; DestDir: {app}\bin; Components: runtime
Source: @IS_SOURCE@\bin\fshow.exe; DestDir: {app}\bin; Components: runtime
Source: @IS_SOURCE@\bin\loadmap.exe; DestDir: {app}\bin; Components: runtime
Source: @IS_SOURCE@\docs\aubit4gl.ico; DestDir: {app}\docs; Components: runtime
Source: @IS_SOURCE@\docs\changelog.txt; DestDir: {app}\docs; Components: runtime
Source: @IS_SOURCE@\docs\COPYING; DestDir: {app}\docs; Components: runtime
Source: @IS_SOURCE@\docs\CREDITS; DestDir: {app}\docs; Components: runtime
Source: @IS_SOURCE@\docs\LICENSE; DestDir: {app}\docs; Components: runtime
Source: @IS_SOURCE@\lib\libA4GL_file.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libA4GL_HTML.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libA4GL_string.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libaubit4gl.dll; DestDir: {app}\bin; Components: runtime
; is this needed?
Source: @IS_SOURCE@\lib\libaubit4gl.dll.a; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libDATA_menu_list.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libDATA_report.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libDATA_struct_form.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libEXREPORT_NOPDF.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libFORM_GENERIC.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libMENU_GENERIC.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libMSG_NATIVE.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libPACKER_PACKED.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libPACKER_PERL.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libPACKER_XML.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libRPC_NORPC.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libSQL_odbc32.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libUI_CONSOLE.dll; DestDir: {app}\lib; Components: runtime
Source: @IS_SOURCE@\lib\libUI_GTK.dll; DestDir: {app}\lib; Components: runtime
;Not native, requires CygWin:
;Source: @IS_SOURCE@\lib\libUI_TUI.dll; DestDir: {app}\lib; Components: runtime

;=========================
;Example code:
Source: @IS_SOURCE@\tools\test\make.bat; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\testmenu.menu; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\file.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\form.per; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\hello.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\hello_db.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\hello2.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\helpfile.msg; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\pdf_report.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\test_build.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\test_select.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\testmenu.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\assoc2.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\testmpz.4gl; DestDir: {app}\tools\test; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\gui.per; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\calc.per; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\form-gui.per; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\gui.4gl; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\calc.4gl; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\hello-gui.4gl; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\multi.per; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\radio.per; DestDir: {app}\tools\test\gui; Components: 4GLexamples
Source: @IS_SOURCE@\tools\test\gui\widget.per; DestDir: {app}\tools\test\gui; Components: 4GLexamples

;=========================
; Help files:
Source: @IS_SOURCE@\README.txt; DestDir: {app}; Components: help

;=========================
; Shell files:
Source: @IS_SOURCE@\bin\4glpc; DestDir: {app}\bin; Components: Shell
Source: @IS_SOURCE@\bin\amake; DestDir: {app}\bin; Components: Shell
Source: @IS_SOURCE@\bin\aubit; DestDir: {app}\bin; Components: Shell
Source: @IS_SOURCE@\install.sh; DestDir: {app}; Components: Shell
Source: @IS_SOURCE@\configure; DestDir: {app}; Components: Shell

;=========================
; Make files:
Source: @IS_SOURCE@\Makefile; DestDir: {app}; Components: Make
Source: @IS_SOURCE@\tools\test\gui\Makefile; DestDir: {app}\tools\test\gui; Components: Make
Source: @IS_SOURCE@\tools\test\Makefile; DestDir: {app}\tools\test; Components: Make
Source: @IS_SOURCE@\incl\i4gl.mk; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\a4gl-rules.mki; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\d4gl.mk; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\footer.mki; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\footer-c.mki; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\header.mki; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\a4gl.mk; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\Makefile-common; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\Makefile-install.mki; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\maximise.mki; DestDir: {app}\incl; Components: Make
Source: @IS_SOURCE@\incl\q4gl.mk; DestDir: {app}\incl; Components: Make

;=========================
;GTK libs: (add GTK themes here:)
Source: @IS_SOURCE_GTK@\iconv.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libatk-1.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libgdk_pixbuf-2.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libgdk-win32-2.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libglib-2.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libgmodule-2.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libgobject-2.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libgtk-win32-2.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libintl-1.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libpango-1.0-0.dll; DestDir: {app}\bin; Components: GTK
Source: @IS_SOURCE_GTK@\libpangowin32-1.0-0.dll; DestDir: {app}\bin; Components: GTK

;=========================
;Helpers:
;add native unix2dos and dos2unix - instead, fix compiler and make it obsolete
;Source: @IS_SOURCE@\bin\run.exe; DestDir: {app}\bin; Components: util
Source: @IS_SOURCE@\tools\cygwin\run.exe; DestDir: {app}\bin; Components: util


[INI]
Filename: {app}\@FULLNAME@ on the Web.url; Section: InternetShortcut; Key: URL; String: http://@AUBIT_WEBSITE@; Flags: uninsdeleteentry

[Icons]
Name: {group}\@FULLNAME@ on the Web; Filename: {app}\@FULLNAME@ on the Web.url
Name: {group}\Uninstall @FULLNAME@; Filename: {uninstallexe}

[Registry]
;=========================
;For current user:
Root: HKCU; Subkey: Software\Aubit project; Flags: uninsdeletekeyifempty
Root: HKCU; Subkey: Software\Aubit project\Aubit 4GL compiler; Flags: uninsdeletekey
Root: HKCU; Subkey: Software\Aubit project\Aubit 4GL compiler; ValueType: string; ValueName: AUBITDIR; ValueData: {app}
Root: HKCU; Subkey: Software\Aubit project\Aubit 4GL compiler; ValueType: string; ValueName: A4GL_UI; ValueData: GTK
Root: HKCU; Subkey: Software\Aubit project\Aubit 4GL compiler; ValueType: string; ValueName: Version; ValueData: 0.30 RC4; Flags: uninsdeletekey

;=========================
;All again for HKLM
Root: HKLM; Subkey: Software\Aubit project; Flags: uninsdeletekeyifempty
Root: HKLM; Subkey: Software\Aubit project\Aubit 4GL compiler; Flags: uninsdeletekey
Root: HKLM; Subkey: Software\Aubit project\Aubit 4GL compiler; ValueType: string; ValueName: AUBITDIR; ValueData: {app}
Root: HKLM; Subkey: Software\Aubit project\Aubit 4GL compiler; ValueType: string; ValueName: A4GL_UI; ValueData: GTK
Root: HKLM; Subkey: Software\Aubit project\Aubit 4GL compiler; ValueType: string; ValueName: Version; ValueData: 0.30 RC4; Flags: uninsdeletekey

;=========================
;Environment:
;On Windows 95/98/Me, you'll need to modify AUTOEXEC.BAT to set environment variables.
;Inno Setup does not include any built-in feature for that, however you could write a
;small program to do that and execute it via the [Run] section.
;User-specific environment variables:
Root: HKCU; Subkey: Environment; ValueType: expandsz; ValueName: Path; ValueData: "{code:GetUserPath};{app}\bin;{code:GetMinGWPath}\bin"
;Now same for system-wide environment:
Root: HKLM; Subkey: SYSTEM\CurrentControlSet\Control\Session Manager\Environment; ValueType: expandsz; ValueName: Path; ValueData: "{code:GetSystemPath};{app}\bin;{code:GetMinGWPath}\bin"
;This fake key is added just to invoke EnvUpdate function, since I did not find
;a better way to invoke it:
Root: HKCU; Subkey: Environment; ValueType: string; ValueName: DUMMY; ValueData: {code:EnvUpdate}

[UninstallDelete]
Type: files; Name: {app}\@FULLNAME@ on the Web.url
Type: files; Name: {app}\tools\test\*.frm.xml
Type: files; Name: {app}\tools\test\*.c
Type: files; Name: {app}\tools\test\*.exe
Type: files; Name: {app}\tools\test\*.err
Type: files; Name: {app}\tools\test\*.glb
Type: files; Name: {app}\tools\test\*.h
Type: files; Name: {app}\tools\test\*.hlp

[_ISTool]
EnableISX=true

[Code]
const
  xxWnd = $FFFF;

{=========================}
{ Get current system PATH}
function GetSystemPath(S: String): String;
var
  	CurrentPath: String;
begin
	{FIXME: do not add path to Aubit if allready in Path}
	RegQueryStringValue(HKLM, 'SYSTEM\CurrentControlSet\Control\Session Manager\Environment', 'Path', CurrentPath);
  	Result := CurrentPath;
end;

{=========================}
{ Get current user's PATH}
function GetUserPath(S: String): String;
var
  	CurrentPath: String;
begin
	{FIXME: do not add path to Aubit if allready in Path}
	RegQueryStringValue(HKCU, 'Environment', 'Path', CurrentPath);
  	Result := CurrentPath;
end;


{=========================}
{ Get current MinGW installation path}
function GetMinGWPath(S: String): String;
var
  	CurrentPath: String;
begin
	{FIXME: do not add to path if MinGW if allready in Path}
	RegQueryStringValue(HKLM, 'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\MinGW_is1', 'Inno Setup: App Path', CurrentPath);
  	Result := CurrentPath;
end;

{=========================}
{ Send notification to running programs, that Environment settings changed (PATH)}
function EnvUpdate(S: String): String;
var
  	Wnd, Msg, WParam, LParam: Longint;
begin
	{
	See:
	http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessage.asp
	function SendMessage(const Wnd, Msg, WParam, LParam: Longint): Longint;
	Sends the specified message to the specified window. Does not return until the window
	procedure has processed the message.
	}
	{ -------------- example from InstaqllShield ---------------
	#define HWND_BROADCAST 0xFFFF;
	#define WM_SETTINGCHANGE 0x001A;
    HWND    hWnd;
    LONG    lParam;
    LONG    wParam;
    SHORT   shMsg;
    STRING  szParam;
    hWnd    = HWND_BROADCAST;
    shMsg   = WM_SETTINGCHANGE;
    wParam  = 0;
    szParam = "Environment";
    lParam  = &szParam;
    SendMessage(hWnd, shMsg, wParam, lParam);
	-------------------------------------------------------------}

	Wnd := 0;
	Msg := 0;
	WParam := 0;
	LParam := 0;

	SendMessage(Wnd, Msg, WParam, LParam);

end;

{ ======================================== EOF ====================================== }

