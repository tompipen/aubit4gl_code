
#  ==========================================================================
#  Main makefile for compile and install of fgldoc tools
#
#  Developed by Sergio Ferreira, Lisbon, Portugal
#
#  $Id: Makefile.in,v 1.4 2003-01-03 02:11:20 afalout Exp $
#
#  ==========================================================================

include FgldocDefs.mk

# =========================================================================
#                           Settings
# =========================================================================

ALL				=parser
ALL.INSTALL		=install.parser install.manager

ifneq "@JAVAC@" "no"
	ALL			+=browser
endif

ifneq "@TOMCAT_DIR@" "no"
	ALL.INSTALL	+=install.browser
endif

ALL.PERLMODS	= install.cpan install.dbi install.tk install.unit \
				install.dbd-informix

.PHONY:all parser manager browser install clean install.parser \
		install.manager install.browser deinstall install.cpan install.dbi \
		install.tk install.unit install.dbd-informix missing.perlmods \
        all.perlmods


# =========================================================================
#                        	   Targets
# =========================================================================

all: ${ALL}
	@echo ""
	@echo "+--------------------------------------------------------------------+"
	@echo "| Doc4gl default targets (${ALL}) successfully compiled."
	@echo "|                Execute 'make install' to install it.               |"
	@echo "+--------------------------------------------------------------------+"
	@echo ""

parser:
	$(MAKE) -C parser all

manager:
	$(MAKE) -C manager all

browser:
	$(MAKE) -C browser all

# =========================================================================
#                           	Install
# =========================================================================

install: ${ALL.INSTALL}
	@echo ""
	@echo "+--------------------------------------------------------------------+"
	@echo "| Doc4gl default install targets (${ALL.INSTALL}) installed."
	@echo "|       See User's manual for usage instructions                     |"
	@echo "+--------------------------------------------------------------------+"
	@echo ""

install.parser:
	$(MAKE) -C parser install

install.manager:
	$(MAKE) -C manager install

install.browser:
	$(MAKE) -C browser install

# =========================================================================
#                           Deinstall
# =========================================================================
deinstall:
	$(MAKE) -C parser deinstall
	$(MAKE) -C manager deinstall
	$(MAKE) -C browser deinstall

# =========================================================================
#                                Clean
# =========================================================================
clean:
	$(MAKE) -C parser clean
	$(MAKE) -C manager clean
	$(MAKE) -C browser clean

# =========================================================================
#                           Install Perl modules
# =========================================================================

#Fixme: is there a way to accept all defaults when installing using CPAN
#and avoid all this prompting?

all.perlmods: ${ALL.PERLMODS}

missing.perlmods: @MISSING_PERLMODS@
	@echo ""
	@echo "+--------------------------------------------------------------------+"
	@echo "|                          *** NOTE ***                              |"
	@echo "|         Doc4gl missing Perl modules installation finished          |"
	@echo "|       Please re-run 'configure' to update changed configureation   |"
	@echo "+--------------------------------------------------------------------+"
	@echo ""

#if you're using ActivePerl on Windows, the PPM (Perl Package Manager) has
#much of the same functionality as CPAN.pm.
#manual: http://search.cpan.org/author/JHI/perl-5.8.0/lib/CPAN.pm
install.tk:
	perl -MCPAN -e 'install Bundle::Tk'

install.unit:
	perl -MCPAN -e 'install Test::Unit'

install.dbd-informix:
ifneq "@DBD_INFORMIX_USERNAME@" ""
ifneq "@DBD_INFORMIX_PASSWORD@" ""
	(export DBI_DBNAME=@DOC4GL_DB@; \
	export DBD_INFORMIX_DATABASE=@DOC4GL_DB@; \
	export DBD_INFORMIX_USERNAME=@DBD_INFORMIX_USERNAME@; \
	export DBD_INFORMIX_PASSWORD=@DBD_INFORMIX_PASSWORD@; \
	perl -MCPAN -e 'install DBD::Informix')
else
	@echo "ERROR: Informix DB password not specified. Cannot install DBD::Informix"
	@echo "re-run configure like this, to specify them:"
	@echo "./configure --with-ifx-uname=MyUserName --with-ifx-pwd=MyPassword"
endif
else
	@echo "ERROR: Informix DB user name not specified. Cannot install DBD::Informix"
	@echo "re-run configure like this, to specify them:"
	@echo "./configure --with-ifx-uname=MyUserName --with-ifx-pwd=MyPassword"
endif

install.cpan:
	perl -MCPAN -e 'install Bundle::CPAN'

install.dbi:
	perl -MCPAN -e 'install Bundle::DBI'


# =============================== EOF ======================================
