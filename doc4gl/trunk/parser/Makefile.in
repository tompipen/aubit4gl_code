#  ============================================================================
#  TITLE : P4gl - Informix 4gl parser and repository loader
#
#  AUTHOR : Sergio Ferreira
#           Moredata, Lda - Lisbon, Portugal
#
# $Id: Makefile.in,v 1.1 2003-01-01 06:38:34 afalout Exp $
#
#  DESCRIPTION : Makefile for fgldoc 4gl parser compilation
#
#  ============================================================================

include ../FgldocDefs.mk

# ============================================================================
#                           Settings
# ============================================================================

ALL=p4gl p4glpp

.PHONY:install deinstall clean tags

#  4gl Pre-Processor source files
#    It resolve all the inclusions of globals (globals "file.4gl") and
#    generates a temporary file.
P4GLPPOBJ= p4pp_lex.o m_p4glpp.o


#  4GL Parser source files
P4GLOBJ= p4gl_synt.o p4gl_ld_st.o p4gl_lex.o p4gl_parse.o  \
		p4gl_util.o p4gl_dump_st.o  p4gl_ins_rep.o actions.o GenFglDoc.o \
		InsertP4glRep.o StringBuffer.o CommentLexer.o ParseComment.o \
        GenParameters.o


#  ============================================================================
#                           Targets
#  ============================================================================
all: ${ALL}
	@echo "Default targets (${ALL}) compiled successfully."

p4gl : $(P4GLOBJ)
	$(ESQL) $(CFLAGS) -o $@ $^

p4glpp: $(P4GLPPOBJ)
	$(ESQL) $(CFLAGS) -o $@ $^

#  ============================================================================
#                           Sub - tartgets
#  ============================================================================

# Compilation of esql/c API for inserting in the repository
p4gl_ins_rep.o:
	$(ESQL) $(CFLAGS) -c $*.ec
#	${RM} p4gl_ins_rep.c

# TODO - Fazer regra genérica
# Compilation of esql/c API for inserting in the repository
InsertP4glRep.o:
	$(ESQL) $(CFLAGS) -c $*.ec
#	${RM} InsertP4glRep.c

#  Create lexer for comments
CommentLexer.c:
	$(LEX) -PyyComment -o$*.c $*.l
#	$(CC) $(CFLAGS) -c CommentLexer.c

p4gl_lex.c:
	$(LEX) -o$@ $*.l

p4pp_lex.c:
	$(LEX) -o$@ $*.l


#  ==========================================================================
#  							Generate tag(s) file
#  ==========================================================================
tags:
	@-${RM} tags
	touch *c
	ctags *.c

#  ==========================================================================
#  							Install the software
#  ==========================================================================

install: ${ALL}
	${INSTALL} $^ $(BINDIR)

deinstall:
	${RM} -f $(BINDIR)/p4gl $(BINDIR)/p4glpp


#  ==========================================================================
#  								Clean
#  ==========================================================================
clean:
	--${RM} -f *.o ${ALL} lex.yy.c y.tab.h y.tab.c a.out core y.output \
	*.4go *.4gi *.4ge *.bak CommentLexer.c p4pp_lex.c p4gl_lex.c p4gl_synt.c \
    p4gl_ins_rep.c InsertP4glRep.c sqexplain.out


# =============================== EOF =======================================

