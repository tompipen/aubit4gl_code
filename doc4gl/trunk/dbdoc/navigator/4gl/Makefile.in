#  ============================================================================
#
#  Copyright 1992 DESPODATA - Lisboa, PORTUGAL
#
#  Divisao de desenvolvimento e producao de software.
#
#  Autor:  Sergio Alexandre ferreira
#          Pedro Higgs Menezes
#
#
#  ----------------------------------------------------------------
#  DESCRICAO: Makefile para utilitario bdesquema.
#
#  ============================================================================

ROOT=../../..

include ${ROOT}/FgldocDefs.mk


#include /usr/desenvolv/include/4glbuilt.mk
O=xxx

VPATH 			=./4glsrc:./forms
export VPATH

LIBSDIR=/usr/desenvolv/lib/
MYFGLDIR=/usr/desenvolv/bin/4gl
BINDIR=/usr/desenvolv/bin/bin
FGLFORM=/usr/desenvolv/bin/perform

LIBS=${LIBSDIR}Llibfgldd.4go ${LIBSDIR}d_libglob.4go

FGEI=.4gi

ALL=bdesquema$(FGEI) modulos$(FGEI) BdeUtil$(FGEI)

SCRIPTS=bdesquema modulos
BDESQUEMA=./bdesquema
MODULOS=/modulos

FORMS = par_bde.frm ged_mod.frm ged_mtab.frm

#4GLCOMP=d4gl-pcode
#4GLCOMP=aubit
#4GLCOMP=querix
4GLCOMP=i4gl-pcode

#  ============================================================================
#  Compila todos .4go(s)
#  ============================================================================
#all: $(ALL)
all:
	export DEFAULT=${4GLCOMP}; amake


#  ============================================================================
#  Utilitario bdesquema.
#  ============================================================================
BDEUTIL_MOD= BdeUtil$O
BdeUtil$(FGEI): $(BDEUTIL_MOD) $(FORMS)
		$(FGLLN) $(BDEUTIL_MOD) $(LIBS) $(OUT_OP) $@

#  ============================================================================
#  Utilitarios do bdesquema.
#  ============================================================================
BDE_MOD= main_bde$O bdesquema$O d_get_tipo$O
BDE_FORM = par_bde.frm
bdesquema$(FGEI): $(BDE_MOD) $(FORMS)
		$(FGLLN) $(BDE_MOD) $(LIBS) $(OUT_OP) $@

#  ============================================================================
#  Manutencao de modulos
#  ============================================================================
mod_MOD=scr_mod$O gl_mod$O ext_mod$O m_mod$O \
scr_mtab$O gl_mtab$O ext_mtab$O cr_ext$O
mod_FORM=ged_mod.frm ged_mtab.frm
modulos$(FGEI): $(mod_MOD) $(mod_FORM)
		$(FGLLN) $(mod_MOD) $(LIBS) $(OUT_OP) $@


#  ============================================================================
#  Instalacao dos utilitarios no sitio certo.
#  ============================================================================
old.install: $(ALL)
	-- chmod 664 $(ALL)
	-- chmod 664 $(FORMS)
	cp $(ALL) $(MYFGLDIR)
	cp $(ALL) /usr/appl/bdesquema/bin/4gl
	cp JoinTabelas.class /usr/appl/html-docs
	cp $(FORMS) $(FGLFORM)
	cp $(SCRIPTS) $(BINDIR)

install: make.bdesquema make.modulos
	cp ${BDESQUEMA} /usr/bin
	cp ${MODULOS} /usr/bin
#where should this go?
#	cp JoinTabelas.class /usr/appl/html-docs

make.bdesquema:
	@echo "if [ $# -lt 1 ]" > ${BDESQUEMA}
	@echo "then" >> ${BDESQUEMA}
	@echo "	echo 'Usage: bdesquema database_name'" >> ${BDESQUEMA}
	@echo "	echo" >> ${BDESQUEMA}
	@echo "	exit 1" >> ${BDESQUEMA}
	@echo "else" >> ${BDESQUEMA}
	@echo "	DATABASE=$$1" >> ${BDESQUEMA}
	@echo "	DBPATH=$$DBPATH:${DOC4GLSRCDIR}/dbdoc/navigator/4gl/forms" >> ${BDESQUEMA}
	@echo "	export DBPATH" >> ${BDESQUEMA}
	@echo "fi" >> ${BDESQUEMA}
	@echo "fglgo ${DOC4GLSRCDIR}/dbdoc/navigator/4gl/bdesquema $DATABASE 'INT' '???'" >> ${BDESQUEMA}
	@echo " " >> ${BDESQUEMA}

make.modulos:
	@echo "# Utilitario para geracao de modulos e associacao de tabelas a modulos" > ${MODULOS}
	@echo "if [ $# -lt 1 ]" >> ${MODULOS}
	@echo "then" >> ${MODULOS}
	@echo "   echo 'Usage: modulos databse_name '" >> ${MODULOS}
	@echo "	echo" >> ${MODULOS}
	@echo "	exit 1" >> ${MODULOS}
	@echo "else" >> ${MODULOS}
	@echo "	DATABASE=$$1" >> ${MODULOS}
	@echo "	DBPATH=$$DBPATH:${DOC4GLSRCDIR}/dbdoc/navigator/4gl/forms" >> ${MODULOS}
	@echo "	export DBPATH" >> ${MODULOS}
	@echo "fi" >> ${MODULOS}
	@echo "fglgo ${DOC4GLSRCDIR}/dbdoc/navigator/4gl/modulos $DATABASE" >> ${MODULOS}
	@echo " " >> ${MODULOS}

#  ============================================================================
#  Limpa a directoria corrente
#  ============================================================================
clean:
	${RM} *.4go *.4gi *.4bk *.o a.out core *.err *.frm *.o *.bak *.ao *.aox \
    *.4gx
	export DEFAULT=${4GLCOMP}; amake clean
	cd 4glsrc; ${RM} *.4go *.4gi *.4bk *.o a.out core *.err *.frm *.o *.bak \
	*.ao *.aox *.4gx *.c *.h *.glb
	cd forms; ${RM} *.err *.frm *.bak
	@echo ""
	@echo "+--------------------------------------------------------------------+"
	@echo "|             DBdoc 4GL browser source code now clean.               |"
	@echo "+--------------------------------------------------------------------+"
	@echo ""


Makefile: Makefile.in
	cd ${ROOT}; config.status --file=dbdoc/navigator/4gl/Makefile; cd -
